
user              www-data; 
worker_processes  1; 
 
error_log  /var/log/nginx/error.log; 
 
pid        /var/run/nginx.pid; 
 
 
events { 
    worker_connections  1024; 
} 
 
 
http { 
upstream backend {
<% @webserver.each do |webserver| -%>
    server <%= webserver['cloud'].nil? ? webserver['ipaddress'] : webserver['cloud']['public_ipv4'] -%>:8080 ;
<% end %>    
}
server {
   listen 80; 
   location / {
      proxy_pass http://backend;
   }
}

 
 
 
 
    include       /etc/nginx/mime.types; 
    default_type  application/octet-stream; 
 
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" ' 
                      '$status $body_bytes_sent "$http_referer" ' 
                      '"$http_user_agent" "$http_x_forwarded_for"'; 
 
    access_log  /var/log/nginx/access.log  main; 
 
    sendfile        on; 
    #tcp_nopush     on; 
 
    #keepalive_timeout  0; 
    keepalive_timeout  65; 
 
    #gzip  on; 
     
    # Load config files from the /etc/nginx/conf.d directory 
    # The default server is in conf.d/default.conf 
    include /etc/nginx/conf.d/*.conf; 
 
}